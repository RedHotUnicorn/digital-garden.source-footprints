---
title: Закон больших чисел и закон больших грабель / Хабр
date: 2024-01-04
src_link: https://www.notion.so/aecf2b5f65424c23880a10524732adf7
src_date: '2024-01-04 12:20:00'
gold_link: https://habr.com/ru/articles/784556/
gold_link_hash: a5f4a022ca1e5dc28e7a4b0640537952
tags:
- '#host_habr_com'
---

![](https://habrastorage.org/getpro/habr/upload_files/202/324/a67/202324a67bd5097ff1bc00e7fc1a9118.jpg "Виды грабель (показаны основные)")

Виды грабель (показаны основные)

Бросание монеты - дело не хитрое да и оборудование для экспериментов не очень дорогое. Бросай себе и бросай. Этот простой эксперимент дает неожиданно много следствий, многие из которых не очевидны, а порой и контринтуитивны.

Моя интуиция с завидным постоянством подсказывает мне неверное решение поэтому я собрал замечательную коллекцию грабель на которые я наступал и хотел бы ее показать публике. Я не буду использовать формул и законы больших чисел, эти столпы теорвера нам не понадобятся. Обойдемся только граблями их будет много и разных.

#### Разница между количеством выпавших орлов и решек.

*“Однако если бросаний произведено очень много, то числа выпавших гербов и решек окажутся почти равными. И равенство будет выполняться тем точнее, чем больше произведено бросаний.”* 

Это цитата из отличного учебника физики [1], мне он очень нравится. В этой цитате очень важно слово **почти**, в нём всё дело, это грабли, я на них наступал. Это “почти” означает **отношение** числа орлов к числу решек. Это как раз один из законов больших чисел.

Если говорить не “почти”, а в “точности”, разница между количеством орлов и решек в процессе бросания монеты будет увеличиваться. Вероятность совпадения числа орлов и решек с увеличением числа бросков стремится к нулю. 

Получается такое утверждение: “С увеличением числа бросков вероятность **почти** одинакового количества орлов и решек стремится к 1, а вероятность их точного совпадения стремится к 0”. Или так:  “С увеличением числа бросков будет **почти** одинаковое количество орлов и решек, но точного их совпадения не будет”. Расчехляйте интуицию, будем ею пользоваться.

Общеприняты две модели аналогичные бросанию монеты. Первая модель - это блуждание точки на прямой. В начальный момент точка находится в нуле, после броска монеты в случае выпадения орла точка сдвигается на единицу в положительном направлении, в случае решки - на единицу в отрицательном направлении. Так вот в этой модели среднее значение удаления точки от нуля будет - ноль, а разброс значений, т.е. дисперсия будет равна корню квадратному из числа бросков . Таким образом с ростом числа бросков мы можем получить **любую** наперед заданную разницу между орлами и решками, притом **любое** количество раз, главное не ленится бросать и бросать. 

Вторая модель  - это два игрока назовем их Олег и Роман, пусть после каждого броска монеты если выпал орел выигрывает один рубль Олег, а если выпала решка - в таком же выигрыше Роман.

#### Время нахождения в выигрыше

Представим долгую игру Олега и Романа с тысячами бросаний монеты. В процессе игры то Олег, то Роман будет находится в чистом выигрыше, в какие-то моменты они будут “при своих”, то есть будет ничья, после каждой ничьей лидерство может сменится и кто-то будет опять в выигрыше. Я предполагал, что время нахождения в выигрыше для каждого из игроков будет примерно одинаковое, а ничьи будут достаточно часты, ну уж точно, ничьи скорее будут, чем их не будет.  Это грабли, я на них танцевал.

Одинаковое время нахождения в выигрыше игроков - самое маловероятное событие. Самое вероятное число смены лидерства - 0 (ноль), одна смена вероятнее чем две, а две чем три…  Вероятнее всего, что игрок выигравший первый бросок так и останется всегда в выигрыше.  Как бы долго мы не бросали монету. Здесь работает не закон больших чисел, а закон арксинуса. 

И да, конечно, математическое ожидание выигрыша любого из игроков - 0 (ноль).

#### Количество ничьих

Предположим Олег и Роман бросают монету через равные промежутки времени. Моя интуиция подсказывала мне, что за четыре часа игры ничьих будет приблизительно в четыре раза больше чем за час. Опять грабли, я на них маршировал. Ничьих будет больше всего в два раза, И чем дольше будет продолжаться игра, ничьи будут случаться все реже и реже. За 20 бросаний монеты самое вероятное ( вероятность немного больше 0,5) число ничьих не более 2-х раз, а 10 ничьих имеют вероятность в 8 раз меньше (0,06), вероятность отсутствия ничьих - 0,2. При 10.000 бросаний количество ничьих будет около 40 раз, медиана - 68 ничьих, увеличив число бросаний в 100 раз число ничьих увеличится лишь в 10 раз.

Какова же вероятность хотя бы одной ничьей? Она равна 1, то есть ничья обязательно будет. А как долго ждать этого? В среднем - бесконечно. Если игра будет продолжаться бесконечно то количество ничьих будет бесконечно и каждой из них в среднем нужно ждать бесконечно…  Но только при идеальной монете, если монета не идеальна, то количество ничьих будет ограничено даже при бесконечной игре.

#### Разорение игрока

Еще один вопрос который возникает в связи с игрой Олега и Романа: "Как скоро закончится игра в связи с тем, что у одного из них закончатся деньги?". Например, если у Олега в начале игры был 1 рубль, а у Романа  100 рублей, сколько в среднем продлится игра если за один бросок монеты разыгрывается 1 рубль? Весь мой “опыт” игры в орлянку подсказывал мне, что не долго, 5-10 бросков и всё. Но, грабли, я без них никуда, они всегда со мной. Игра в среднем продлится 100 бросков. А если у каждого по 100 рублей? Длительность игры - 10.000 бросков до разорения одного из игроков! Дайте мне каску.

Вот еще для тренировки интуиции - пусть Олег богат как Крез, бесконечно богат, а Роман решил кардинально решить проблему с кредитом и последние 100 рублей решил отдать в игру. Как долго продлится игра? Средняя продолжительность игры - бесконечная игра. Вероятность проигрыша Романа - 1, то есть он точно проиграет, но через бесконечное время игры.

#### Разорение игрока при нечестной монете

В этой [статье](https://statweb.stanford.edu/~susan/papers/headswithJ.pdf), исследовав реальную монету, выяснили, что вероятность выпадения одной из сторон равна не ½, а что-то около 0,51 (округляю для простоты). Что будет, если играть с бесконечно богатым противником этой монетой и знать какая сторона монеты выпадает чаще? Например у вас есть всего один рубль, тогда у вас появляется вероятность не разориться, она равна 0,04, а вот если у вас есть 100 рублей, то эта вероятность не разориться увеличивается до 0,98, но вот только продолжительность этой игры велика и игра может вообще никогда не закончится.

#### Разорение игрока при двух нечестных монетах

Представим что Олег и Роман при игре используют две нечестных монеты с одинаковым отклонением от ½, но в разные стороны - одна в пользу Олега, вторая в пользу Романа. Выбор монеты определяется случайно, после каждого броска, например честной монетой. Возрастет ли продолжительность игры в этом случае? Вроде как при большом количестве бросков влияние отклонения от честности используемых монет должно компенсироваться, так как отклонения одинаковы, но с разными знаками. Грабли. Продолжительность игры сильно вырастет по сравнению с игрой честной монетой.

#### Выигрыш до  первой ничьи

После начала игры Олега и Романа, кто-то вырвется вперед. Давайте загадаем какой-то выигрыш для этого удачного игрока. Например, 10 рублей. Первый вопрос - сколько ожидается раз у лидера будет этот выигрыш до первой ничьей? Второй вопрос - если мы увеличим ожидаемый выигрыш в 10 раз до 100 рублей, сколько ожидается таких выигрышей до первой ничьей? Грабли. Кажется логичным, что выигрышей в 100 рублей будет меньше чем выигрышей в 10 рублей. В действительности они будут равновероятны и количество обоих выигрышей вероятнее всего - 1.

#### Блуждание на плоскости и в пространстве

Про блуждание по прямой - в одномерном пространстве, я уже написал, и это просто другая модель бросания монеты.

Возможно поблуждать и в двухмерном пространстве, часто приводят аналогию с пьяным матросом вышедшим из бара. В этом случае интересны два вопроса: вернется ли когда-то матрос в бар и как далеко уйдет матрос от бара за Ъ шагов. В бар он вернется, обязательно. Расстояние на которое матрос уйдет от бара таково, что средний квадрат расстояния пропорционален количеству шагов.

Этот вопрос - “Как далеко уйдет матрос?”, первые решили Эйнштейн и Смолуховский. Здесь нет грабель, но есть очень любопытное следствие. С помощью этого решения, была определена постоянная Больцмана, а заодно и вычислено число Авогадро [2]. Вот так, покидав монетку, посмотрев на броуновское движение и подумав о пьяном матросе можно посчитать атомы.

Блуждание в трехмерном пространстве не гарантирует возврат в исходную точку, увы. Как остроумно сформулировал [Сидзуо Какутани](https://ru.wikipedia.org/wiki/%D0%9A%D0%B0%D0%BA%D1%83%D1%82%D0%B0%D0%BD%D0%B8,_%D0%A1%D0%B8%D0%B4%D0%B7%D1%83%D0%BE) «Пьяница рано или поздно найдет свой путь домой, а вот пьяная птица может потеряться навсегда». Это печальное событие имеет вероятность 0,65, а математическое ожидание числа возвращений около 0,5. В среднем пьяная птица вернется домой полраза, в 65-ти пьянках из 100.

#### Что выпадет раньше ОО или ОР

Бросаем монету до тех пор пока не выпадет два орла (ОО) или орел и решка (ОР). Сколько в среднем нужно сделать бросков до получения одной из заданных последовательностей? Для начала, отметим что вероятности обоих результатов равны и составляют ¼, после выпадения первого орла, с вероятностью ½ выпадет орел или решка. Напрашивается вывод, что ожидание для обоих результатов будет одинаковым. Я так и думал, но интуиция как всегда подвела, это были очередные грабли, я на них загорал. Среднее время ожидания ОО - 6 бросков, а для ОР - 4. 

Как то на Хабре, была [статья](https://habr.com/ru/articles/774018/) о доказательстве равновероятности выпадения орла или решки после выпадения подряд 20-ти орлов.. Даже Википедия [рассмотрела](https://ru.wikipedia.org/wiki/%D0%9E%D1%88%D0%B8%D0%B1%D0%BA%D0%B0_%D0%B8%D0%B3%D1%80%D0%BE%D0%BA%D0%B0) эту ситуацию.

Подольем масла в огонь размышлений. После выпадения 20-ти орлов у нас может выпасть либо орел либо решка. Давайте подсчитаем сколько в среднем нам придется ждать этих последовательностей:

Последовательность из 21-го орла в среднем придется ждать 4.194.302 броска.

Последовательность из 20-ти орлов и затем решки придется ждать 2.097.150 броска.

То есть 20 орлов и 1 решка выпадет в среднем почти в два быстрее чем 21 орел , несмотря на то, что вероятности этих комбинаций одинаковы.

И эта последняя последовательность имеет самое малое среднее время появления вместе с инвертированной последовательностью (20-ть решек и затем один орел) и отображенной последовательностью (один орел и 20-ть решек). Дальше грабли пойдут еще жирнее.

Для тех, кому кажется, что комбинация из 21 результата где орлы и решки чередуются, ну, в “соответствии” с законом больших чисел подсчитаем время ожидания - 2.796.202 броска.

А еще неожиданно (для меня, как и все остальные грабли) что ожидаемое количество бросков всегда четно.

#### Корова больше чем баран, баран больше чем курица, курица больше чем…  корова.

На различии времени ожидания для разных комбинаций построена игра Пенни, [вот она](https://ru.wikipedia.org/wiki/%D0%98%D0%B3%D1%80%D0%B0_%D0%9F%D0%B5%D0%BD%D0%BD%D0%B8) в Википедии. Но там не описано самое неожиданное в этой игре. Возьмем три комбинации: РРОР, РОРР и ОРРР. Вероятность каждой 1/16. Время ожидания появления каждой соответственно  - 18, 18, и 16 бросков. (А например, для комбинации ОРОР ожидание 20 бросков (подмигнул)).

Первая комбинация выигрывает у второй - 3 к 2, (т.е. она будет выигрывать 3 игры из 5) другими словами вероятность выигрыша первой комбинации над второй ⅗, что больше чем половина игр, вторая комбинация выигрывает у третьей - 7 к 5 (вероятность 7/12, что тоже больше ½), вроде напрашивается вывод, что первая комбинация должна выигрывать у третьей тем более. Напрашиваются грабли. Третья комбинация выигрывает у первой 7 к 5!

И еще одни грабли - ожидание второй комбинации - 18 бросков, а третьей - 16, но тем не менее вторая выигрывает у третьей. Другими словами комбинацию, вероятность победы которой выше, ждать нужно дольше! Вот как бывает, а интуиция то этого не знает!

#### Равное количество выпадений орлов и решек у нескольких монет.

Если мы будем бросать несколько различимых монет одновременно и подсчитывать сколько орлов выпало у каждой монеты. Всегда ли мы сможем получить одинаковое количество орлов у всех монет имея возможность бросать бесконечно? Я даже не буду упоминать про мои грабли, я без них никуда. Итак  если мы будем бросать 2 или 3 монеты, мы сможем получить бесконечное число совпадений количества орлов у всех монет. Правда среднее время ожидания бесконечно. Если же монет будет больше чем три, то даже и при наличии бессмертия и бесконечного времени ожидания, мы получим лишь ограниченное количество совпадений. При всем том же бесконечном времени ожидания.

#### Длина чистых серий

Условимся называть серию “чистой” если она состоит только из одних орлов или решек.  Какова средняя длина чистой серии? Проверяем интуицию, про свою я даже и не буду говорить. Средняя длина - 2. Теперь для любителей замечаний про  не симметричную монету. Какова длина серий в этом случае? Во-первых, длина четных серий и нечетных будет разная. Это первые грабли. Длина нечетных серий будет зависеть от соотношения вероятностей выпадения орлов и решек.  Для ранее описанной монеты с вероятностями 0,51 к 0,49 длина нечетных серий будет 2,0016.  А длина четных… осторожно, грабли номер два - будет **всегда**, независимо от величины несимметричности монеты равна 2.

#### Чуть - это важно.

Представим ваш друг, всегда говорящий правду, бросает монету так, что вы не видите результата. Он делает первый бросок и говорит вам, что выпал орел. Далее он делает еще один бросок. Какова вероятность что в результате двух бросков будет два орла? Правильно, это  ½.

Теперь **чуть** изменим ситуацию, друг бросил монету два раза и сказал вам что орел выпал в один из бросков, а про другой бросок ничего не сказал. Какова вероятность что выпало два орла? Правильно, это  ⅓.

#### Грабельки на внимательность.

Ваш честный друг положил в коробку две монеты одинаковыми сторонами вверх и попросил нас угадать какой стороной они лежат. Вероятность нашего успеха - ½. Вот прямо так - либо угадаем, либо нет.  Но есть трюк, который позволит нам ответить на этот вопрос. Следите за руками:

Просим добавить к этим монетам третью, **О**рлом вверх. Получаем три монеты которые лежат в одной из следующих комбинации - **О**ОО, **О**ОР, **О**РО, **О**РР.  Вероятность каждой комбинации  - ¼. Теперь посчитаем вероятность вытащить Орла из коробки. При первой комбинации ООО вероятность вытащить орла - 1, при второй и третьей - ⅔, при четвертой - ⅓. Общая вероятность:

1\*¼ + ⅔\*¼ + ⅔\*¼ + ⅓\*¼ = ⅔.

Иногда приводят довод, что монеты не различимы и комбинаций будет три, а не четыре: ООО, ОРО, ОРР и вероятность каждой комбинации ⅓.  Хорошо, посчитаем вероятность вытащить орла в этом случае:

1\*⅓ +⅔\*⅓ + ⅓\*⅓ = ⅔. Ничего не изменилось, во как.

Что же значит вероятность вытащить орла равная ⅔? При трех монетах это значит только одно! А именно - так как один орел был добавлен нами, то до нашего добавленного орла монеты с одинаковыми верхними сторонами лежали так - одна вверх орлом, а другая - решкой. Такая вот загогулина. 

Замечание для тех, кто добавляет к фразу типа “реальная монета, она не идеальная, не симметричная, а значит и результат отличается от теоретического…” да, результат отличается от теоретического, но не меняется метод и смысл решения. И кстати, для получения максимально близкого результата к результату идеальной монеты, монета **должна** быть **не** идеальной.

Все изложенные в статье факты и цифры, это мое личное мнение, любые совпадения случайны, при бросании монет ни одна из монет, вероятно, не пострадала. Повторение опытов вы производите на свой страх и риск, автор ответственности не несет. 

P.S. В последнем "парадоксе" о том что две монеты с **одинаковыми** верхними сторонами, одна лежит орлом, а другая решкой, читатель указал на невозможные комбинации приведенные мной. Исправляю:

Возможные комбинации: 

Вариант №1: О+ОО, О+РР. Вероятность - 1\*1/2 + 1/3\*1/2 = 2/3.

Вариант №2: О+ОО, ОО+О, О+РР, РР+О. Вероятность - 1\*1/4+1\*1/4+1/3\*1/4+1/3\*1/4=2/3.

Вариант №3: О+ОО, О+О+О, ОО+О, О+РР, Р+О+Р, РР+О. Вероятность - 1\*1/6+1\*1/6+1\*1/6+1/3\*1/6+1/3\*1/6+1/3\*1/6= 2/3.

[1] Сивухин Д.В. Общий курс физики: Учеб.пособие: Для вузов. В 5 т. Т.II. Термодинамика и молекулярная физика. - 5-е изд., испр. - М.: ФИЗМАТЛИТ. 2005. -544с.

[2] Р. Фейнман, Р. Лейтон, М. Сэндс. Фейнмановские лекции по физике. — М.: Мир, 1965.

[3] В.Феллер Введение в теорию вероятностей и ее приложения. Том 1. М.: Мир 1967.