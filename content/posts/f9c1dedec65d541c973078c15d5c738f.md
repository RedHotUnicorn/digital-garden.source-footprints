---
title: 'Вестник Midjourney: новая документация, генерация фрагментов и тюнер стилей
  / Хабр'
date: 2024-01-10
src_link: https://www.notion.so/Midjourney-9c4a194173914ccab6ce96a6d38d45a4
src_date: '2024-01-10 07:38:00'
gold_link: https://habr.com/ru/companies/selectel/articles/777920/
gold_link_hash: f9c1dedec65d541c973078c15d5c738f
tags:
- '#host_habr_com'
---

![](https://habrastorage.org/r/w1560/webt/vz/n9/pv/vzn9pv70yo0r7z2tbb0fqvsiscw.png)  

В начале 2023 года я рассказывал о [четвертой](https://habr.com/ru/companies/selectel/articles/709944/) версии Midjourney, а затем — о альфа-доступе к [пятой](https://habr.com/ru/companies/selectel/articles/722900/). Сейчас актуальная версия — 5.2, а недавно вышла альфа шестой.  

  

Сохраним хронологию и посмотрим, что нового в пятой версии. Спойлер: разработчики уделили внимание не только процессу генерации, но и удобству пользователя.  

  

Под катом рассказываю о нововведениях и различиях между релиз- и альфа-версией. Конечно, с иллюстрациями. Если формат окажется интересным, протестирую шестую Midjourney и напишу о ней в [Академии Selectel](https://slc.tl/3ocp1). Подробности под катом!  

  

Генерации
---------

  

### Хаос и странности

  

  

![](https://habrastorage.org/r/w1560/webt/v_/8r/xy/v_8rxyd_gc5tja3cysulqts7jbe.png)  

*Запрос: woman portrait soft sunset light --seed 2131932819, --chaos 0 (**[слева](https://cdn.discordapp.com/attachments/1001883306146660443/1184904259117006918/f1remoon_woman_portrait_soft_sunset_light_3b608f45-bad4-495c-97a1-00612cf9850b.png)**), --chaos 100 (**[справа](https://cdn.discordapp.com/attachments/1001883306146660443/1184904369624322108/f1remoon_woman_portrait_soft_sunset_light_0da526ae-2c31-4b73-b728-d0e714af27aa.png)**).*  

  

В версии 5.2 появилось два параметра, которые влияют на эстетическую составляющую сгенерированных изображений.  

  

* **--chaos или --c**. Принимает значение от 0 до 100. По умолчанию равен 0. Чем больше значение, тем более непохожими могут быть изображения в сгенерированной сетке.
* **Экспериментальный параметр --weird**. Принимает значение от 0 до 3000. По умолчанию равен 0. Чем больше, тем более странной будет генерация.

  

![](https://habrastorage.org/r/w1560/webt/el/gq/z5/elgqz554y2ukyn4bsp7xhfn2wns.png)  

*Запрос: woman portrait soft sunset light --seed 2131932819 --weird 3000 (**[слева](https://cdn.discordapp.com/attachments/1001883306146660443/1184906181802721421/f1remoon_woman_portrait_soft_sunset_light_d4554755-8375-4ed6-b8c9-6817a0dc9e8c.png)**,* *[справа](https://cdn.discordapp.com/attachments/1001883306146660443/1184906016521977987/f1remoon_woman_portrait_soft_sunset_light_b44af60e-fea1-4789-98d5-467dfe49893b.png)**).*  

  

Параметр `weird` полностью соответствует названию не только из-за странных картинок, но и отсутствия детерминированности. Несовместимость с параметром `seed` и, как следствие, генерация разных изображений по одному «зерну» заявлена в [документации](https://docs.midjourney.com/docs/weird).  

  


> Стоимость подписки на месяц не изменилась и составляет $30. Этот тарифный план включает 15 часов генерации в приоритетном режиме и безлимит в пониженном приоритете. Параллельно можно запускать до трех генераций.

  

### Частичная генерация

  

![](https://habrastorage.org/r/w1560/webt/qz/oh/1y/qzoh1y2m5hmq820s__e1efyzzmm.png)  

*Запрос: cat --seed 1123391209 ([слева](https://cdn.discordapp.com/attachments/1001883306146660443/1184911654249582733/f1remoon_cat_e56af4e0-e258-444a-9c19-bc3f3d52993d.png), [справа](https://media.discordapp.net/attachments/1001883306146660443/1184912127199301712/f1remoon_cat_e43716cb-1886-4aef-ac91-4474db15733f.png))*.  

  

В Midjourney существенно расширили функциональность для обработки изображений после первичной генерации. Сегодня доступны такие опции:  

  

* **Vary** **(Strong)** — генерирует новое изображение с опорой на текущее;
* **Vary** **(Subtle)** — генерирует новое изображение, схожее по композиции и стилю, но более детализированное;
* **Vary (Region)** — исправляет фрагменты;
* **Upscale (2x) / Upscale (4x)** — увеличивают ширину и высоту изображения в указанное количество раз. Исходное изображение (1024x1024) можно увеличить до 2048x2048 или 4096x4096 соответственно;
* **Zoom Out (2x, 1.5x, Custom)** — генерирует «рамку» вокруг исходного изображения, будто мы удаляемся назад;
* **Pan (⬅️➡️⬆️⬇️)** — «продлевает» изображение в указанную сторону.

  

![](https://habrastorage.org/r/w1560/webt/dx/ie/td/dxietdcvkc2kefvykz3bzfol0t8.png)  

*Пример: изменение фона.*  

  

Ура — в списке доступна самая желаемая функция: теперь можно перерисовать отдельные фрагменты изображений. При нажатии на кнопку Vary (Region) открывается редактор, в котором можно выделить прямоугольную или произвольную область и отредактировать запрос. Правда, текущий редактор не самый удобный.  

  

* Изображение нельзя увеличить.
* Выделение произвольной области не прощает ошибок. В случае «неровности» проще стереть и нарисовать заново.
* Выделенную область нельзя стереть, можно только отменить кнопкой Undo в верхнем левом углу.

  

Однако функция перерисовки уже есть — этого пока достаточно. Уверен, в будущем редактор станет более удобным. Главное, что это не единственная функция, которой может похвастаться пятая версия.  

  

![](https://habrastorage.org/r/w1560/webt/v7/zd/np/v7zdnpz9nvrs3yp7x5f7daeozj0.png)  

*Отличия Subtle и Strong.* *[Источник](https://docs.midjourney.com/docs/variations)**.*  

  

По умолчанию кнопки Vary (Strong) и Vary (Subtle) изменяют изображение по своему усмотрению, но через команду `/settings` можно включить режим Remix. Это позволит уточнить запрос для перегенерации.  

  


> **Возможно, эти тексты тоже вас заинтересуют:**  
> 
>   
> 
> → [Революция или косметические изменения? Новые поколения серверных процессоров Intel](https://habr.com/ru/company/selectel/blog/779020)  
> 
> → [Процессоры, диски, оперативка — топовое железо 2023 года](https://habr.com/ru/company/selectel/blog/783794)  
> 
> → [Как создать веб-приложение на базе Telegram Mini Apps](https://habr.com/ru/company/selectel/blog/783462)

  

### Видео

  

В четвертой версии алгоритма меня разочаровало, что отключили параметр `--video`. Я даже уточнил у поддержки и получил ответ, что такой функциональности «нет и не будет». Но что-то поменялось, этот параметр вернулся и работает для всех модификаций пятой версии модели.  

  

Кроме того, в Midjourney v5 создавать видео можно не только для первичных генераций, но и вариаций. Если изначальный запрос содержит параметр `--video`, все перегенерации будут с видео.  

  

[![](https://habrastorage.org/r/w1560/webt/jo/9z/ra/jo9zraniejxp86oi8v6zjfhtglu.png)](https://selectel.ru/services/cloud/managed-databases/?utm_source=habr.com&utm_medium=referral&utm_campaign=dbaas_article_mj5_050124_banner_002_ord)  

  

Массовые генерации
------------------

  

Массовые операции — это еще одна функция, за которую хвалили Stable Diffusion. Теперь она доступна в Midjourney.  

  


> **Дисклеймер:** команды ниже запускают множество параллельных запросов, каждый из которых тарифицируется по отдельности.

  

### Комбинации

  

![](https://habrastorage.org/r/w1560/webt/id/cz/ut/idczut0q4biespmp0pseojmkymi.png)  

Midjourney реализует синтаксис для создания комбинаций при запросе.  

  

Что важно учитывать:  

  

* В фигурных скобках через запятую перечисляются варианты;
* Запятая в варианте экранируется обратным слэшем;
* Вариант может быть вложенным списком вариантов;
* Если в запросе несколько списков, используется их декартово произведение;
* Варьировать можно все: ссылки на изображения, части запроса или параметры.

  

Например, запрос `/imagine A {sculpture, painting} of a {seagull {on a pier, on a beach}, poodle {on a sofa, in a truck}}` превратится в следующие команды:  

  


```
/imagine A sculpture of a seagull on a pier.
/imagine A sculpture of a seagull on a beach.
/imagine A sculpture of a poodle on a sofa.
/imagine A sculpture of a poodle in a truck.
/imagine A painting of a seagull on a pier.
/imagine A painting of a seagull on a beach.
/imagine A painting of a poodle on a sofa.
/imagine A painting of a poodle in a truck.

```
  

Если в команде будет синтаксис комбинаций, нужно будет подтвердить действия. При этом в диалоге можно посмотреть, как именно раскрылись указанные комбинации.  

  

### Тюнер стилей

  

![](https://habrastorage.org/r/w1560/webt/p9/rx/up/p9rxupfx3kyk9xqhmlpszkiwqki.png)  

Тюнер стилей (style tuner) — это необычный и дорогой инструмент для создания визуального стиля на основе опроса.  

  

Алгоритм работы:  

  

1. Пользователь вводит команду `/tune` с желаемым запросом;
2. Midjourney уточняет количество стилей: 16, 32, 64 или 128 — генерация одного стиля занимает примерно 0.01 час на GPU;
3. В течение двух минут будет сгенерирована ссылка на тюнер — например, [такая](https://tuner.midjourney.com/2yH1kxN);
4. Пользователь выбирает понравившиеся стили одним из двух вариантов:
1. Даны пары изображений, нужно выбрать наиболее симпатичное. Если оба изображения не нравятся, можно не выбирать;
2. Даны все изображения в случайном порядке. Необходимо выбрать понравившиеся.
1. Тюнер генерирует уникальный код, который можно использовать в запросах. Например, так: `/imagine cat --style wi1MSMe3ruIbeSp0L8bt6T`.

  

  

![](https://habrastorage.org/r/w1560/webt/xf/ms/cy/xfmscy0tsjky8vw62pu5lxrcmbo.png)  

*Пример тюнера в режиме «все изображения в случайном порядке*».  

  

Входные параметры для создания тюнера наталкивают на вопрос: можно ли использовать коды стилей в других запросах? Ответ: да, но это может привести к необычным результатам.  

  

Тюнер стилей доступен только для fast-генерации, так что это дорогое удовольствие. Как можно бюджетно воспользоваться этой функциональностью?  

  

* **Используйте случайные стили.** Например, параметр `--style random-X-Y`, где X — это количество стилей (16, 32, 64 или 128), а Y — это процент выбранных стилей (если не указать, то по умолчанию 75%).
* **Выполните команду /tune.** Если кто-то уже создавал тюнер с таким же запросом, бот предложит ссылки.
* **Подглядите коды стилей у других пользователей.** Код стиля можно подставить в ссылку `https://tuner.midjourney.com/code/<код стиля>`. Однако этот способ не работает для кодов, которые сгенерированы случайным образом.

  

Тюнер стилей совместим с параметром `chaos`, но не работает с параметром `weird`.  

  

Работа с текстом
----------------

  

### img2txt

  

Один из интересных подходов для генерации схожих изображений — конвертация изображения в текст с последующей генерацией на основе последнего.  

  

![](https://habrastorage.org/r/w1560/webt/7d/p_/dy/7dp_dy2rdvimelcekwi7y9x878q.png)  

*Арты Culpeo Fox, гном из Half-Life и Джонни* *Сильверхенд**.*  

  

Для описания изображения в Midjourney есть команда `/describe`, которая принимает на вход файл. В результате возвращает четыре варианта описания, которые можно отредактировать и отправить на генерацию.  

  

### Токенайзер

  

![](https://habrastorage.org/r/w1560/webt/x8/jh/fp/x8jhfpnkwkxynaoxbgenhqsejaw.png)  

Ранее я затрагивал тему значимости определенных слов при генерации изображений. Тогда это было скорее наблюдение, а сейчас для этого есть отдельная команда — `/shorten`. Она возвращает список важных токенов, которые повлияют на генерацию, а также сокращенные варианты пользовательских запросов.  

  

![](https://habrastorage.org/r/w1560/webt/c3/cn/co/c3cncoklckxm_i2a7gbgx-zaxp0.png)  

*Кнопка Show Details позволяет посмотреть веса токенов.*  

  


> **Интересное наблюдение:** в запросе `portrait of beautiful woman` токенайзер считает лишним слово woman. И если запрос состоит исключительно из portrait, то Midjourney в 100% случаев сгенерирует портрет девушки.

  

Изменение на сайте
------------------

  

![](https://habrastorage.org/r/w1560/webt/rd/mf/sv/rdmfsvclfhc2mpytgphe742v6f4.png)  

Сайт midjourney.com — это галерея пользовательских изображений. Раньше она решала вопрос доступа к своим генерациям лишь частично и сохраняла лишь таблицы изображений, а одиночные картинки загружались только после апскейлинга. Так что «вырезать» четвертинку все равно нужно было вручную. Сейчас эту проблему исправили: все изображения, в том числе со старых версий Midjourney, в галерее доступны раздельно.  

  

На скриншоте выше видно интригующую заглушку. Кажется, интерфейс генерации изображений появится в веб-интерфейсе! [Документация](https://docs.midjourney.com/) разделилась на две ветки: Current и Legacy. При этом Legacy — это новая краткая документация по моделям ранних версий, а не просто «свалка» прошлогодней документации. Что из этого получится — увидим в будущем.  

  


> Если вам интересно читать топики о программировании, Telegram, играх и других технологиях, подписывайтесь на мой [канал](https://t.me/%252BVzpLr5pam-MxODEy), где периодически пишу на разные темы. А еще — делитесь мнением о пятой версии Midjourney в комментариях.