---
aliases:
- https://habr.com/ru/articles/762540/
- https://habr.com/ru/articles/762540/?utm_source=habrahabr&utm_medium=rss&utm_campaign=762540
title: Когда начинает работать закон больших чисел / Хабр
date: 2023-09-30
src_link: https://www.notion.so/8a27cb0dd1ff47b89ce7530b5d13353e
src_date: '2023-09-30 18:33:00'
gold_link: https://habr.com/ru/articles/762540/
gold_link_hash: 4dc853e59d7c54e8b8d2a79f9460363a
tags:
- '#host_habr_com'
---

![](https://habrastorage.org/getpro/habr/upload_files/d5f/649/f65/d5f649f65d103c248482cd605c58ace6.png)Большие числа != большим числам.

Число 100 большое? Зависит от ситуации. Сравниваем ли мы его с 0,001, или с 100000? Как и многое в жизни, понятие «большой» относительно.

В этом посте мы объясним, насколько большим должно быть «большое» и докажем, что вы, скорее всего, ошибаетесь насчёт закона больших чисел.

Закон больших чисел (ЗБЧ)
-------------------------

Проведём эксперимент: будем бросать кубик, как делали это на уроках знакомства с вероятностями. Будем продолжать совершать тысячи бросков, каждый раз вычисляя среднее выпавшее значение. 

(Следует помнить, что среднее ожидаемое значение броска кубика равно (1+2+3+4+5+6)/6 = 3,5.)

Вот график первых десяти бросков.

![](https://habrastorage.org/getpro/habr/upload_files/916/991/cc6/916991cc61cb67ab478cd7b59974d6da.png "Красное — среднее ожидаемое значение, жёлтое — среднее значение выборки")

Красное — среднее ожидаемое значение, жёлтое — среднее значение выборки

Сначала мы выбросили 5, затем 1, и так далее. 

Теперь давайте проверим, что произойдёт, если увеличить количество экспериментов до 100 и 1000:

![](https://habrastorage.org/getpro/habr/upload_files/20b/d26/f5e/20bd26f5e5b2f0a1a9df448085f57249.png)![](https://habrastorage.org/getpro/habr/upload_files/94a/f46/e5c/94af46e5cdf804cab9dc0ec74a72bf77.png)Чем «больше» становится число, тем ближе средние значения выборки к истинному ожидаемому значению. Закон больших чисел говорит именно об этом: среднее значение выборки сходится к среднему ожидаемому значению. 

Если точнее, существует две версии ЗБЧ: слабая и сильная.

Слабый закон постулирует следующее.

![](https://habrastorage.org/getpro/habr/upload_files/04a/9ca/8b9/04a9ca8b98f5ccd886e128145207ae45.png)Иными словами, вероятность того, что среднее значение выборки *X̅*ₙ окажется («выпадет») сколь-нибудь далеко от ожидаемого значения μ, сходится к нулю с увеличением количества размера выборки (*n*). («Сколь-нибудь далеко» означает отклонение больше любого заранее фиксированного значения.) Подробнее мы рассмотрим это ниже.

Похоже, *n* = 1000 достаточно «большое» для эксперимента с кубиком. А как насчёт других ситуаций?

Давайте рассмотрим другой пример! Вот этот лотерейный билет из Техаса со стираемыми полями.

![](https://habrastorage.org/getpro/habr/upload_files/ca9/a27/eee/ca9a27eee70d495aff56c8386fce467c.png)На [официальной веб-странице](https://www.texaslottery.com/export/sites/lottery/Games/Scratch_Offs/details.html_252701659.html) написано следующее:

* Выигрыши на общую сумму $829 миллионов!
* Сумма выигрыша от $150!
* Шанс выиграть $20 000 000
* Билет стоит всего $100!

Звучит прекрасно, но мы знаем математику достаточно хорошо, чтобы не обманываться этими числами. Если покопаться, мы сможем найти вероятность выигрыша. Вот таблица выигрышей с официального сайта:

![](https://habrastorage.org/getpro/habr/upload_files/d45/34e/572/d4534e57206ba67b01b134f7adc5bd2b.png "Сумма выигрыша, приблизительное количество победителей, примерные шансы (1 к *)")

Сумма выигрыша, приблизительное количество победителей, примерные шансы (1 к \*)

Зная это, мы можем с лёгкостью вычислить наши шансы и ожидаемые значения:

* шанс что-то выиграть составляет 26,34%,
* а ожидаемая выплата составляет $75,28958 на билет. (Не учитывая $100 за участие.)

Похоже, билет за $100 покупать не стоит, потому что ожидаемое значение равно всего примерно $75,3. 

А теперь давайте проведём эксперимент, похожий на эксперимент с кубиком. Мы (гипотетически) покупаем всё больше и больше билетов, параллельно вычисляя средние выигрыши. Чем больше билетов мы купим, тем ближе будем к ожидаемому значению (примерно $75).

С первыми десятью билетами нам не очень повезло.

![](https://habrastorage.org/getpro/habr/upload_files/acc/326/f80/acc326f801f0ec0e8e870e270f48174d.png)Но давайте купим ещё девяносто! С сотней билетов мы приблизились к ожидаемому, но на долгую перспективу нам нужен сглаженный график рядом с красной линией.

![](https://habrastorage.org/getpro/habr/upload_files/647/665/9f0/6476659f090a0c2b386d521ff87d6b79.png)Давайте совершим шаг побольше: увеличим *n* до 10000.

Теперь у нас получилась плавная линия, но это совсем не то, что мы ожидали! Она находится примерно рядом с $67, а не с ожидаемым значением.

![](https://habrastorage.org/getpro/habr/upload_files/324/7bc/b2d/3247bcb2dbe33a330c8792d6cc28bf36.png)Давайте пойдём дальше. С одним миллионом билетов снова происходит что-то странное: нам начинает везти и выигрыши превышают среднее. Теперь мы отдалились ещё больше!

Похоже, 1000000 — это всё ещё не «большое» число!

![](https://habrastorage.org/getpro/habr/upload_files/e29/f88/5be/e29f885be662942b31bff572935196c5.png)Пойдём дальше! При десяти миллионах билетов у нас получается множество крупных выигрышей, которые поднимают среднее вверх, но эффект становится всё меньше и меньше. Мы медленно, но верно приближаемся к ожидаемому значению. 

Теперь мы наконец получили ожидаемую плавную линию, находящуюся рядом с истинным средним.

![](https://habrastorage.org/getpro/habr/upload_files/6d0/a10/af2/6d0a10af2ecbd060a31d797786877a08.png)В первом эксперименте мы смогли продемонстрировать закон больших чисел на тысяче бросков, но во втором не хватает даже миллиона.

Большие числа != большим числам.

Как же объяснить странности, произошедшие во втором эксперименте?

Дисперсия и скорость сходимости
-------------------------------

Давайте приглядимся к слабому закону больших чисел!

По сути, вероятность *P*(|*X̅*ₙ - μ| > ε) — это показатель расстояния между средним значением выборки до истинного среднего (то есть ожидаемого значения) в вероятностном смысле.

![](https://habrastorage.org/getpro/habr/upload_files/6f6/01b/920/6f601b92064c9fd0cc72b2e70aa04bc0.png "Расстояние от среднего значения выборки (жёлтое) до истинного среднего (красное)")

Расстояние от среднего значения выборки (жёлтое) до истинного среднего (красное)

Чем меньше ε, тем больше вероятностное расстояние. В математической записи верно следующее:

![](https://habrastorage.org/getpro/habr/upload_files/274/578/029/274578029b416d543a15c3b4074497f2.png)Слабый закон больших чисел гласит:

![](https://habrastorage.org/getpro/habr/upload_files/e41/f24/e4a/e41f24e4a7924b7e0fcbb179f7d02063.png)То есть вероятностное расстояние становится маленьким, как мы и хотели.

Грубо говоря, это означает, что среднее значение выборки равно истинному среднему плюс распределение, которое становится всё более и более концентрированным в области нуля. Иными словами, мы имеем:

![](https://habrastorage.org/getpro/habr/upload_files/3ac/d6f/c2e/3acd6fc2e7480ee8b950d8e2f7a5af2d.png "(D)= означает, что величины справа и слева от этого знака равенства распределены одинаково")

(D)= означает, что величины справа и слева от этого знака равенства распределены одинаково

асимптотическое расширение в смысле распределения. Член *o*(1) обозначает распределение, которое с ростом *n* становится всё более концентрированным в области нуля. Возможно, вы знакомы с обозначениями большого и малого «O»; это тоже самое, но с распределениями вероятности.

Объясняет ли слабый закон больших чисел и асимптотическое расширение происходящее с нашими лотерейными билетами; то есть, почему нам нужно десять миллионов выборок, чтобы достаточно приблизиться к истинному среднему?

Краткий и жёсткий ответ: *нет*.

Нам нужно асимптотическое расширение большего размера. Нашим инструментом для этого будет центральная предельная теорема — один из самых известных результатов в теории вероятностей, формализующий понимание того, почему средние значения выборки напоминают гауссовы распределения.

Центральная предельная теорема
------------------------------

Давайте сразу нырнём с головой и перейдём непосредственно к центральной предельной теореме (central limit theorem, CLT). Она гласит, что с точки зрения распределения масштабированные на √*n* средние центрированные значения выборок сходятся к стандартному нормальному распределению. (Термин «центрированные» означает, что мы вычитаем ожидаемое значение.)

![](https://habrastorage.org/getpro/habr/upload_files/a6d/864/28e/a6d86428e33f192d0b52ffa301bd6d72.png)Нужно подчеркнуть, что эта сходимость справедлива в случае распределений. Это просто иной способ сказать, что кумулятивные функции распределения являются сходящимися поточечно. (Знаю, сходимость в теории вероятностей — это довольно запутанная тема.)

Давайте развернём это: для асимптотического расширения закон больших чисел и центральная предельная теорема подразумевают, что

![](https://habrastorage.org/getpro/habr/upload_files/a5c/9a6/45d/a5c9a645d7c9db0d13a9807fef73fae0.png)то есть среднее значение выборки равно сумме 1) ожидаемого значения μ, 2) масштабированного нормального распределения и 3) распределения, сводящегося к нулю быстрее, чем 1/√*n*.

То есть для нашего асимптотического расширения мы имеем

![](https://habrastorage.org/getpro/habr/upload_files/0bd/577/685/0bd577685688417e6c36295dcc5d0ba0.png)Это можно переписать в упрощённом виде, если объединить константы в нормальное распределение. А именно, мы получаем

![](https://habrastorage.org/getpro/habr/upload_files/963/8c6/a8b/9638c6a8b1a89c5a25250d8873083a9a.png)и это значит, что наше асимптотическое расширение принимает вид

![](https://habrastorage.org/getpro/habr/upload_files/290/49f/141/29049f1418a1821d133bf49caf819c2b.png)Иными словами, при больших *n* среднее значение выборки приблизительно равно нормальному распределению с дисперсией σ²/*n*. Чем больше *n,* тем меньше дисперсия; чем меньше дисперсия, тем сильнее нормальное распределение концентрируется рядом с ожидаемым значением μ.

И это даёт ответ на наш вопрос: каким должно быть зловещее число в законе больших чисел? Это зависит от дисперсии нашего распределения!

Из нашего асимптотического расширения можно понять, что если дисперсия в 10 больше, то, чтобы среднее было так же близко к изначальному, нам нужно приблизительно в десять раз больше выборок. Это происходит из-за члена σ²/*n*, где σ² обозначает дисперсию нашей выборки *X₁*, *X₂*, …, *Xₙ*, а *n* обозначает количество выборок.

Давайте вернёмся к броскам кубиков и лотерее. Дисперсия броска кубика составляет 35/12 ≈ 2,916, а дисперсия техасской лотереи — приблизительно 157 000 000. Это в пятьдесят миллионов больше. То есть в среднем нужна выборка в пятьдесят миллионов раз больше, чтобы среднее значение выборки было столь же близко к истинному среднему, как и в случае кубиков.

Также важно заметить, что поскольку закон больших чисел — это вероятностная формулировка, утверждения типа «нам нужно в пятьдесят миллионов раз больше образцов» должны пониматься вероятностно. Если нам повезёт, среднее значение выборки может быть очень близко к истинному среднему же через несколько тысяч образцов. 

Заключение
----------

Закон больших чисел часто понимают неверно.

Мы используем его достаточно часто, но он имеет важную тонкость. Хотя среднее значение выборки сходится (почти гарантированно) к ожидаемому значению, скорость сходимости зависит от дисперсии выборки. Чем больше дисперсия, тем медленнее сходимость.

И для множества практических применений это оказывается плохим известием. Например, поэтому сходимость метода Монте-Карло медленна. В реальной ситуации, например, в азартных играх, у вас даже могут закончиться деньги, прежде чем вы начнёте выигрывать. (Впрочем, у большинства игр в казино ожидаемое значение отрицательно, поэтому в длительной перспективе вы всегда будете проигрывать.)

Какой же можно сделать из этого вывод? Применяя закон больших чисел, всегда учитывайте скорость сходимости.